stages:
  # Stage 1: preprocess raw comments into a CSV for training.
  preprocess:
    cmd: uv run python src/youtube_sentiment/training/preprocess.py --input data/raw/comments.json --output data/processed/comments_cleaned.csv
    deps:
      - data/raw/comments.json
      - src/youtube_sentiment/training/preprocess.py
    outs:
      - data/processed/comments_cleaned.csv

  # Stage 2: train sentiment model from the processed CSV.
  train:
    cmd: uv run python src/youtube_sentiment/training/train.py --data data/processed/comments_cleaned.csv --output-dir models
    deps:
      - data/processed/comments_cleaned.csv
      - src/youtube_sentiment/training/train.py
    outs:
      - models

  # Stage 3: drift report comparing current distribution to baseline.
  drift:
    cmd: uv run python src/youtube_sentiment/training/drift_report.py --current data/processed/comments_cleaned.csv --baseline reports/baseline_distribution.json --output reports/drift_report.json
    deps:
      - data/processed/comments_cleaned.csv
      - reports/baseline_distribution.json
      - src/youtube_sentiment/training/drift_report.py
    outs:
      - reports/drift_report.json

  # Stage 4: evaluation report (metrics + confusion matrix).
  evaluate:
    cmd: uv run python src/youtube_sentiment/training/eval_report.py --input data/processed/comments_cleaned.csv --output reports/eval_report.json
    deps:
      - data/processed/comments_cleaned.csv
      - src/youtube_sentiment/training/eval_report.py
    outs:
      - reports/eval_report.json
